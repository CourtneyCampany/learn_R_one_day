---
title: "Colorado Flood"
output:
  word_document: 
    reference_docx: manuscriptstyle.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In early September 2013, perfect heavy rain led to devastating flooding across the Front Range in Colorado. Boulder was heavily effected receiving 231mm in September 13the and 430mm on September 15the. The average annual precipitation for Boulder is 525mm. There are multiple factors that may have contributed to the seriousness of this precipitation event and the dramatic flooding correlated to it. Potential factors include the actual level of precipitation, level of drought preceding the event, and the temporal patterns of stream discharge following the event. 

In terms of annual precipitation level, 2013 had significantly higher total levels of precipitation than other years in the past two decades, most likely caused by this specific precipitation event (Figure 1). However there have been multiple years previous to 2013 that had similarly high levels of precipitation, however it is hard to tell if this is caused by multiple smaller storms throughout the course of the year or a single large rain even similar to the one in 2013. This data does suggest that 2013 did have unusually high levels of precipitation, but in terms of annual precipitation it was not a once in a century event.

```{r total precip, echo=FALSE, warning=FALSE, message =FALSE, cache=FALSE}
rain<-read.csv("flood/data/rain_co.csv")
rain <- rain[complete.cases(rain$HPCP),]
rain$DateTime <- as.POSIXct(rain$DATE, format="%Y%m%d %H:%M")
rain3 <- rain[rain$DateTime > as.POSIXct("19480701 00:00" , format="%Y%m%d %H:%M"),]
rain3$year <- lubridate::year(rain3$DateTime)
se <- function(x) sd(x)/sqrt(length(x))
rain3_wagg <- doBy::summaryBy(HPCP ~ year, data=rain3, FUN=c(mean,se))
plot(HPCP.mean~year, data=rain3_wagg, ylab="Precipitaion (mm)", xlab='')
with(rain3_wagg, arrows(year, HPCP.mean,year, HPCP.mean+HPCP.se, angle=90, length=.03))
with(rain3_wagg, arrows(year, HPCP.mean,year, HPCP.mean-HPCP.se, angle=90, length=.03))

```

Figure 1. Mean yearly precipitation (mm±SE) from 1950-2013. 2013 had significantly higher annual precipitation than many of the previous years however at least one past year had an annual precipitation of similar magnitude.  

When averages from the past sixty years are taken for each month, there are similar trends throughout the years. July and August have significantly higher levels of precipitation on average (Figure 2). The driest months of the year and December, January, and February. This event occurred during September which normally follows the wet period, beginning the transition to the drier months. If the soil was already saturated prior to this event, it could have lead to higher flooding risks if no more water could be absorbed by the soil. 

```{r monthly orecip, echo=FALSE, warning=FALSE, message=FALSE}
rain<-read.csv("flood/data/rain_co.csv")
rain$DateTime<- as.POSIXct(rain$DATE,format="%Y%m%d %H:%M")
library(lubridate)
rain$month <- month(rain$DateTime)
se <- function(x) sd(x)/sqrt(length(x))
newrain <- rain[complete.cases(rain$HPCP),]
rain_agg <- doBy::summaryBy(HPCP ~ month, data=newrain,FUN=c(mean,se))

plot(HPCP.mean~month, data=rain_agg, ylab="Precipitation (mm)", xaxt='n', ylim=c(0.03,0.12))

with(rain_agg, arrows(month, HPCP.mean,month, HPCP.mean+HPCP.se, angle=90, length=.03))
with(rain_agg, arrows(month, HPCP.mean,month, HPCP.mean-HPCP.se, angle=90, length=.03))

monthaxis <- c("Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept",
               "Oct", "Nov", "Dec")

axis(1, at=1:12, labels=monthaxis, las=3)
```

Figure 2. Mean monthly precipitation levels (mm ±SE) from 1948 to 2013 . July and August have the highest levels of precipitation and January and February have the lowest levels. 

In the two years leading up to the flood, precipitation levels were relatively normal as compared to the past fifty years (Figure 3). Early 2013 had a period of significantly lower precipitation than in corresponding months of other years and the quarter that included the September flood was significantly higher than any other quarters in the past two years. 
```{r quarterly precip, echo=FALSE, warning=FALSE}
rain<-read.csv("flood/data/rain_co.csv")
rain <- rain[complete.cases(rain$HPCP),]
rain$DateTime <- as.POSIXct(rain$DATE, format="%Y%m%d %H:%M")
rain2 <- rain[rain$DateTime > as.POSIXct("20110101 00:00" , format="%Y%m%d %H:%M"),]
rain2$weekyear <- lubridate::round_date(rain2$DateTime, unit="quarter")
rain2_wagg <- doBy::summaryBy(HPCP ~ weekyear, data=rain2, FUN=c(mean, se))
plot(HPCP.mean~weekyear, data=rain2_wagg, ylab="Precipitation (mm)", xlab='', ylim=c(0.06,0.26))

with(rain2_wagg, arrows(weekyear, HPCP.mean,weekyear, HPCP.mean+HPCP.se, angle=90, length=.03))
with(rain2_wagg, arrows(weekyear, HPCP.mean,weekyear, HPCP.mean-HPCP.se, angle=90, length=.03))
```

Figure 3. Average quarterly precipitation (mm±SE) from 2011 to the beginning of 2014. The precipitation during the dry season of 2013 was significantly lower than in previous years. Overall precipitation during the two previously years had similar levels to the past fifty years. 

In order to further assess the causes of the flooding, drought patterns were examined. They were measured in terms of the Palmer Drought Severity Index (PDSI). The PDSI is a hydrological drought index used to assess long-term moisture supply. PDSI is a monthly value (index) that indicates the severity of a wet or dry spell. This index is based on the principles of a balance between moisture supply and demand. The index generally ranges from - 6 to +6, with negative values denoting dry spells, and positive values indicating wet spells. Values exceeding -2 indicate moderate drought and greater than -4 indicate extreme drought. In terms of monthly averages, the driest months reflected by the PDSI are June and July, which is different than what is reflected by direct precipitation values (Figure 4). 

```{r Drought monthly, echo=FALSE, warning=FALSE}
clim_bc<-read.csv("flood/data/climate_co.csv")
clim_bc$Date<-paste(clim_bc$YearMonth, "01", sep='')
clim_bc$Date <- as.Date(clim_bc$Date, format="%Y%m%d")
library(lubridate)
clim_bc$month <- month(clim_bc$Date)
se <- function(x) sd(x)/sqrt(length(x))
newclim_bc <- clim_bc[complete.cases(clim_bc$PDSI),]
clim_agg <- doBy::summaryBy(PDSI ~ month, data=newclim_bc,FUN=c(mean,se))
plot(PDSI.mean~month, data=clim_agg, ylab="PDSI", xaxt='n',ylim=-c(-1.5, 1.5))
with(clim_agg, arrows(month, PDSI.mean,month, PDSI.mean+PDSI.se, angle=90, length=.03))
with(clim_agg, arrows(month, PDSI.mean,month, PDSI.mean-PDSI.se, angle=90, length=.03))
monthaxis <- c("Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept",
               "Oct", "Nov", "Dec")
axis(1, at=1:12, labels=monthaxis, las=3)

```

Figure 4. Mean monthly Palmer Drought Severity Index (PDSI±SE) assigned based on balance between moisture supply and demand. Negative values denote dry spells and positive values denote drought. June and July have the highest moisture demand. 

In 2011, there was only moderate drought however at the end of 2012 into 2013, the PDSI values indicate extreme drought (Figure 5). This means that in the months leading up to the September flood, the topsoil may have completely dried out and made it very hard for the soil to adsorb water once the precipitation began. If it wasn't absorbed it likely ran over the top of the soil throughout the watershed and into streams and rivers causing them to overflow. Normally when water is absorbed, it is either redirected into groundwater or released more slowly preventing this flooding. 

```{r quarterly drought, echo=FALSE, warning=FALSE}
clim_bc<-read.csv("flood/data/climate_co.csv")
clim_bc$Date<-paste(clim_bc$YearMonth, "01", sep='')
clim_bc$Date <- as.Date(clim_bc$Date, format="%Y%m%d")

clim_bc2 <- clim_bc[clim_bc$Date > as.Date("20110101" , format="%Y%m%d"),]
clim_bc2$quarter <- lubridate::round_date(clim_bc2$Date, unit="quarter")
clim_bc2_wagg <- doBy::summaryBy(PDSI ~ quarter, data=clim_bc2, FUN=c(mean, se))
plot(PDSI.mean~quarter, data=clim_bc2_wagg, ylab="PDSI", xlab='')

with(clim_bc2_wagg, arrows(quarter, PDSI.mean,quarter, PDSI.mean+PDSI.se, angle=90, length=.03))
with(clim_bc2_wagg, arrows(quarter, PDSI.mean,quarter, PDSI.mean-PDSI.se, angle=90, length=.03))

```

Figure 5. Mean quarterly Palmer Drought Severity Index (PDSI±SE ) assigned based on balance between moisture supply and demand. Negative values denote dry spells and positive values denote drought. The PDSI values assigned to the months leading up to the 2013 flood indicate severe drought. 

Finally, in terms of quantifying the severity of the flood you can quantify the volume of water moving down the streams and rivers.  In general, river discharge is computed by multiplying the area of water in a channel cross section by the average velocity of the water in that cross section. The fall of 2013 had the highest mean discharge of any quarter in the past two years (Figure 6). This could support the conclusion that the soils were not absorbing the precipitation and it was instead being forced into already full streams and rivers. 

```{r quarterly discharge, echo=FALSE, message=FALSE, warning=FALSE}
discharge<-read.csv("flood/data/discharge_co.csv")
discharge$date <- as.Date(discharge$datetime, format="%m/%d/%y")
discharge$disval_m<- discharge$disValue*0.0283168
dislab<-expression(Stream~~Flow ~~ (m^3~s^-1))
discharge2 <- discharge[discharge$date > "2011-01-01",]
discharge2$quarter <- lubridate::round_date(discharge2$date, unit="quarter")
library(sciplot)
discharge2_wagg <- doBy::summaryBy(disval_m ~ quarter, data=discharge2, FUN=c(mean, se))
plot(disval_m.mean~quarter, data=discharge2_wagg, ylab=dislab, xlab='')
with(discharge2_wagg, arrows(quarter, disval_m.mean,quarter, disval_m.mean+disval_m.se, angle=90, length=.03))
with(discharge2_wagg, arrows(quarter, disval_m.mean,quarter, disval_m.mean-disval_m.se, angle=90, length=.03))

```

Figure 6. Mean quarterly stream flow (m^3s^-1±SE) from 2011-2014. The fall winter quarter of 2013 had the highest rate of discharge of all of the quarters in the previous two years. 
