---
title: "Analyzing The Colorado Flood of 2013"
author: "Karl Brown"
date: "4/2/2018"
output:
  word_document:
    reference_docx: manuscriptstyle.docx
---

```{r setup, include=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r package downloads and more, echo=FALSE,message=FALSE}
library(scales)
library(plotrix)
library(lubridate)

rain<-read.csv("rain_co.csv")
discharge<-read.csv("discharge_co.csv")
clim_bc<-read.csv("clim_co.csv")

clim_bc$Date <- paste(clim_bc$YearMonth,"01", sep="")
clim_bc$Date <- as.Date(clim_bc$Date, format="%Y%m%d")

discharge$Date <- as.Date(discharge$datetime, format="%m/%d/%y")
discharge$disval_m<- discharge$disValue*0.0283168

rain$DateTime <- as.POSIXct(rain$DATE,format="%Y%m%d %H:%M")
rain$HPCP[rain$HPCP==999.99] <- NA

```

Palmer's Drought Severity Index (PDSI) is an index that measures the severity of wet or dry spells and it generally ranges from -6 to 6, with -6 being exceptionally dry and 6 being exceptionally wet. In the past 30 years, PDSI has significantly decreased in Colorado (Figure 1). This increase in dryness in the area can be caused by a decrease in precipitation events and is perhaps caused by climate change.  

```{r figure 1, echo=FALSE}
plot(clim_bc$PDSI~clim_bc$Date,ylab="Palmer Draught Severity Index",xlab="Date",pch=16,col="forestgreen")
pdsireg=lm(clim_bc$PDSI~clim_bc$Date)
ablineclip(pdsireg,x1=min(clim_bc$Date),x2=max(clim_bc$Date),col="red",lwd=2)

```

**Figure 1** Negative relationship between the Palmer drought severity index and time in Colorado.          
\
\
\
\
Average daily precipitation by month peaks in the summer months and is lowest in the winter months (Figure 2). If the flood occurred in September, then perhaps strong rains during the summer months caused a gradual increase in stream discharge that led to the flood. Alternatively, an increase in the amount of precipitation in the month of September of 2013 could have caused the flood to occur.

```{r figure 2, echo=FALSE}

rain2<-rain[complete.cases(rain),]
rain2$month <- month(rain2$DateTime)

se <- function(x) sd(x)/sqrt(length(x))
rain_agg <- doBy::summaryBy(HPCP ~ month, data=rain2, FUN=c(mean,se))
monthaxis <- c("Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept",
               "Oct", "Nov", "Dec")

plot(HPCP.mean ~ month, data=rain_agg, type="b", ylim=c(0.04,0.12),
     ylab="Average Daily Precipitation Each Month (millimeters)", xlab="Month", axes=FALSE)
with(rain_agg, arrows(month, HPCP.mean, month, HPCP.mean+HPCP.se, angle=90,
                      length=0.03))
with(rain_agg, arrows(month, HPCP.mean, month, HPCP.mean-HPCP.se, angle=90,
                      length=0.03))
axis(1, at=1:12, labels=monthaxis, las=3)
axis(2, las=2, cex.axis=0.8)
box()
```

**Figure 2** Average daily precipitation in millimeters by month over the course of a year with standard error bars. Data compiled from precipitation data ranging from 1948 to 2013.       
\
\
\
\









A closer analysis of the average daily precipitation by month for 2013 shows a huge spike in precipitation during the month of September (Figure 3). Precipitation patterns follow the normal pattern shown in Figure 2 up until September when the precipitation levels spike. This sudden increase in precipitation is very likely a massive cause for the flood that occurred in September of 2013.  

```{r figure 3, echo=FALSE}
rain4 <- rain2[year(rain2$DateTime) == 2013, ]

rain4$month <- month(rain4$DateTime)
se <- function(x) sd(x)/sqrt(length(x))
rain_agg4 <- doBy::summaryBy(HPCP ~ month, data=rain4, FUN=c(mean,se))
monthaxis <- c("Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept",
               "Oct", "Nov", "Dec")

plot(HPCP.mean ~ month, data=rain_agg4, type="b", ylim=c(0.04,0.30),
     ylab="Precipitation (millimeters)", xlab="Month", axes=FALSE)
with(rain_agg4, arrows(month, HPCP.mean, month, HPCP.mean+HPCP.se, angle=90,
                      length=0.03))
with(rain_agg4, arrows(month, HPCP.mean, month, HPCP.mean-HPCP.se, angle=90,
                      length=0.03))
axis(1, at=1:12, labels=monthaxis, las=3)
axis(2, las=2, cex.axis=0.8)
box()
```

**Figure 3** Average daily precipitation in millimeters by month for 2013 with standard error bars.       
\
\
\
\




Stream discharge reaches an all time high in 2013 (Figure 4). Stream discharge in prior years remains relatively low with the exception of a couple years where it increases slightly. But, in 2013 stream discharge reaches a high and this is proof that there were very high amounts of water in the stream and a flood occurred. 

```{r figure 4, echo=FALSE}
mycols="forestgreen"
mycols2=alpha(mycols,.7)
plot(discharge$disval_m~discharge$Date,pch=16,col=mycols2,ylab="Stream Discharge (meters)",xlab="Time (years)")
```

**Figure 4** Stream discharge in meters vs. time in years.       
\
\
\
\





Precipitation levels were high is 2013 when the flood occurred, but there were other events in the past in which precipitation were just as high or higher (Figure 5). Figure 5 also shows that there is a positive relationship between daily precipitation and time. Since PDSI has been decreasing with time (Figure 1) and precipitation has been increasing with time (Figure 5), this means that there are likely more dry days followed by days with very high levels of precipitation. This would make flood events more likely, meaning the 2013 flood may not be as big of an anomaly as previously thought. 

```{r figure 5, echo=FALSE}
plot(rain$HPCP~rain$DateTime,col=mycols2,xlab="Time (years)",ylab="Daily Precipitation (millimeters)",pch=16)
hpcpdatereg=lm(rain$HPCP~rain$DateTime)
ablineclip(hpcpdatereg,col="red",x1=min(rain$DateTime),x2=max(rain$DateTime),lwd=3)
```

**Figure 5** Positive relationship between daily average precipitation in millimeters and time.        