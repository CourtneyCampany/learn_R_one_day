---
title: "Elevated Carbon Dioxide Leads to Higher Photosynthesis But Lower ANPP in FACE Forest"
author: "Max Israelit"
date: "4/16/2018"
output: 
  word_document:
    reference_docx: manuscriptstyle.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r all data prep, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(lubridate)
library(doBy)
library(sciplot)
library(reshape2)
se <- function(x) sd(x)/sqrt(length(x))
ps <- read.csv("data/face_photosynthesis.csv")
ps$Date <- paste(ps$Date, "01", sep="")
ps$Date <- as.Date(ps$Date, format="%b_%Y%d")
ps$quarter <- round_date(ps$Date, unit="quarter")

#calculate the difference between the two eco2 and aco2, plot that

psA <- ps[ps$treatment=="aCO2",]
psA$AnetA <- psA$Anet
psA$Anet <- NULL
psA <- droplevels(psA)
psE <- ps[ps$treatment=="eCO2",]
psE$AnetE <- psE$Anet
psE$Anet <- NULL
psE <- droplevels(psE)
pss <- doBy::summaryBy(Anet ~ quarter + treatment, data=ps, FUN=c(mean, se))
pss$ylo <- pss$Anet.mean - pss$Anet.se
pss$yhi <- pss$Anet.mean + pss$Anet.se

anetlab <- expression('A'[net]~(mu~mols~m^-2~s^-1))

lit <- read.csv("data/face_litter.csv")
lit$Date <- as.Date(lit$Date, format="%d/%m/%Y")
lit$year <- as.factor(year(lit$Date))

#must add which treatment belongs to each ring
lit$treatment <- as.factor(ifelse(lit$ring == 2 | lit$ring == 3 | lit$ring == 6, "aCO2", "eCO2"))

#must remove 2 points when big branches fell into litter traps (twig is too big)
lit <- lit[-which.max(lit$twig),]
lit <- lit[-which.max(lit$twig),]

#need to convert units to g C per year (not g biomass per month as it is now)
#biomass in veg is ~50% C

basket_size <- .2 #in m2
c_frac <- .47 #conversion to carbon from biomass

lit_carbon <- data.frame(lit[,c(1:3, 8:9)], (lit[,4:7] * c_frac) /  basket_size) # now it's gC m^-2 month^-1
lit_mean_trap <- summaryBy(twig + bark+ seed + leaf ~ year + Date + ring + treatment,
                              data=lit_carbon, FUN=mean, na.rm=TRUE, keep.names = TRUE) #summarizing by averaging all traps
lit_bug <- summaryBy(leaf ~ Date + treatment, data=lit_mean_trap, FUN=mean, keep.names=TRUE, na.rm=TRUE)

#add all months together within each year
lit_annual <- summaryBy(twig + bark + seed + leaf ~ year + ring + treatment, data=lit_mean_trap, FUN=sum, na.rm=TRUE, keep.names = TRUE)

lit_co2 <- summaryBy(twig + bark + seed + leaf ~ year + treatment, data=lit_annual, FUN=mean, keep.names = TRUE)
lit_co2$group <- paste(lit_co2$treatment, lit_co2$year, sep=" ")
lit_co22 <- lit_co2[,3:7]
library(reshape2)
lit_graph <- melt(lit_co22, id.var="group")
litylab <- expression(~g~C~m^-2~y^-1)
lit_graph$group <- as.factor(lit_graph$group)
levels(lit_graph$group) <- gsub(" ", "\n", levels(lit_graph$group))


wood <- read.csv("data/face_woodbiomass.csv")


ring_diameter <- 25 #ring diameter in m
ring_area <- pi*(ring_diameter/2)^2 #get area
c_frac <- 0.47 #carbon fraction conversion from biomass
kg_to_g <- 1000


total_wood_ring <- summaryBy(biomass_kg ~ year + Ring + treatment, data=wood, FUN=sum, na.rm=TRUE, keep.names=TRUE)
total_wood_ring$Date <- paste(total_wood_ring$year, "/12/31", sep="")
total_wood_ring$Date <- as.Date(total_wood_ring$Date, format = "%Y/%m/%d")

dates <- unique(total_wood_ring$Date)
dates <- dates[order(dates)]
wood_npp <- total_wood_ring[total_wood_ring$Date != dates[1],]
wood_npp$Start_date <- wood_npp$Date #not actually doing anything, just setting the column format up for the FOR Loop

for (i in 1:length(wood_npp$Date)) {
  
  #set start data as the element before 'it' in the date vector. "it" is the date in wood_npp
  wood_npp$Start_date[i] <- dates[which(dates == wood_npp$Date[i]) - 1]  
  #uses our date vector
  
  # finds the previous years biomass for each ring @ right time
  wood_npp$prev_biom_kg[i] <- total_wood_ring$biomass_kg[total_wood_ring$Ring == wood_npp$Ring[i] &
                                                           as.numeric(total_wood_ring$Date-wood_npp$Start_date[i])==0]
}

#unit conversion g per carbon per year per m2
wood_npp$wood_growth <- ((wood_npp$biomass_kg - wood_npp$prev_biom_kg) * c_frac * kg_to_g)/ring_area

#length of period for wood growth (2019-2021 is a problem)
wood_npp$timelength <- as.numeric(wood_npp$Date - wood_npp$Start_date)
wood_npp$wood_yr <- ifelse(wood_npp$timelength == 365, wood_npp$wood_growth/1, wood_npp$wood_growth/2)

#okay that was a pain but now we have annual wood biomass production, let's save it
savewood <- wood_npp[, c(1:3, 5, 10)]
#Now we need to combine wood with other litter data -----
joinwood <- summaryBy(wood_yr ~ year+treatment, data=savewood)
joinwood$group <- paste(joinwood$treatment, joinwood$year, sep=" ")
anpp <- merge(joinwood, lit_co22)
anpp$anpp <- anpp$wood_yr.mean + anpp$twig + anpp$bark + anpp$seed + anpp$leaf
buglab <- expression(Leaf~Litter~(g~C~m^-1~month^-1))
```

Elevated concentrations of carbon dioxide in the atmosphere due to anthropogenic activities are expected to influence plant physiological processes. The complexities of this interaction remain unclear, despite the potential for broad impacts on ecosystem productivity and nutrient cycling. In order to explore the consequences of increasing CO[2], the FACE experiments use artificial CO[2] fertilization to simulate the effects of climate change on forest processes. Here, we use simulated FACE results starting in 2021, when CO[2] fumigation was fully operational. This experiment covered six rings, each 25m diameter circular plots, across two treatment groups (elevated and ambient CO[2]). 

\
#Effects of Fertilization on Photosynthesis 
 
Photosynthesis within each ring was measured every three months using a Li-Cor model 6400 using infrared gas analysis. Photosynthetic rates in plots with elevated CO[2] were higher than those in ambient CO[2] (Figure 1). This elevated response was consistent over the three-year study period, as ambient CO[2] rates were more than one standard error lower than elevated CO[2] rates at all times. This pattern agrees with expectations, as mechanistically higher CO[2] concentrations would decrease photosynthetic rate limitation from carbon availability. These observations confirm that, in this study area, a major limiting factor controlling productivity is carbon dioxide availability. The inter-annual fluctuation in productivity was mirrored by both eCO[2] and aCO[2] plots, perhaps indicating that environmental variables like precipitation or air temperature were responsible as opposed to the treatment itself. 

\
```{r ps plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=pss, aes(x=quarter, y=Anet.mean, fill=treatment, shape=treatment, ymin=ylo, ymax=yhi)) +
  geom_line() +
  geom_point() +
  geom_ribbon(alpha=0.5) +
  theme_classic() +
  theme(legend.position = "top") +
  labs(fill="Treatment", shape="Treatment") +
  labs(x="", y=anetlab)
```
\
**Figure 1.** The effects of FACE treatment on photosynthetic capacity across three years. Mean A[net] was aggregated at the quarter level and marked by the solid line, with ribbons representing standard error. 

\
#Productivity and Litterfall 
 
Litterfall was collected within each plot on a monthly basis using 1 m^2 baskets. Leaf, twig, bark, and seed biomass were separated, dried, and weighed. These values were then converted to grams of carbon per year per meter^2 using a 0.47 carbon biomass fraction. Litter carbon biomass notably increased during the experiment for both elevated and ambient carbon dioxide treatments (Figure 2). Within both, leaf litter comprised the largest proportion of total litterfall, with seed fall comprising the smallest component. Twig and bark fall were comparable following 2020 in both groups. The somewhat comparable levels of litter between treatment groups runs contrary to expected results. With elevated leaf photosynthetic rates, leaf lifespan would be expected to decrease. However, no notable increases in leaf biomass production are observed here and plots with elevated CO[2] even produced less leaf litter than plots with ambient CO[2] in 2022. One explanation for this could be that, despite leaf lifespans being shorter due to increased productivities, fewer leaves are produced in elevated CO[2] conditions as photosynthetic requirements are already being met. 

\
```{r lf plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(lit_graph, aes(x=group, y=value, fill=variable)) +
  geom_bar(stat="identity") +
  theme_classic() +
  theme(legend.position = "top") +
  labs(fill="Component") +
  labs(y=litylab, x="Treatment Group and Year")
```
\
**Figure 2.** Litterfall component magnitude across ambient and elevated CO[2] conditions over four years. 

\
#Aboveground Net Primary Productivity 
 
In order to assess ANPP, litterfall products were combined with tree biomass measurements to represent overall aboveground biomass products. Tree diameters were measured using manual band dendrometers on a yearly basis, with these values input into an allometric regression to calculate overall growth each year in woody biomass. ANPP was consistently higher in plots with ambient CO[2] levels than those with elevated CO[2] (Figure 3). This differs from earlier observations that photosynthesis was higher in elevated CO[2] and that litterfall was comparable across treatment groups. As we know litterfall to be approximately constant, the driving factor between the observed difference in ANPP likely relates to woody biomass growth. It is possible that increased photosynthetic rates from  elevated CO[2] haven't translated into overall productivity due to nutrient limitations, environmental variables, or numerous other factors. However, the data observed here offer no clear explanation and further investigation is needed. 


```{r anpp plot, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data=anpp, aes(x=year, y=anpp, color=treatment, shape=treatment)) +
  geom_line() +
  geom_point() +
  theme_classic() +
  theme(legend.position="top") +
  labs(y=expression(ANPP~(g~C~m^-2~year^-1)), x="", shape="Treatment", color="Treatment") +
  scale_x_continuous(breaks=c(2021, 2022, 2023))
```
\
**Figure 3.** Aboveground Net Primary Productivity across three years and two different CO[2] concentrations. 

\
#Insect Defoliation Events 
 
Over the course of the FACE experiment, several insect outbreaks were observed. The effects of these outbreaks is often to increase leaf litterfall due to defoliation as well as shedding. Based on this assumption, we can predict three to four different defoliation events (Figure 4). Leaf litter levels were relatively well-coupled across treatment groups, though there was some minor variation. Both treatment groups responded equally to the defoliation spike in early 2022, and in late 2023. In late 2022 and early 2023, there were two different spikes. In the first, the ambient CO[2] plots experienced a sharp increase in defoliation, which was followed by a second spike mainly affecting the elevated CO[2] plot. While it is possible that these spikes represent different events, it is also possible that the peaks are the result of the same event and the spread of insects through the plots disproportionately affected one treatment group before the other. This is the more likely scenario given that no obvious mechanisms for one CO[2] concentration being disproportionately affected by insects exist. Foliage quality and quantity are likely similar across treatment groups, so insectivore activity should be comparable. 

```{r bugs, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data=lit_bug, aes(x=Date, y=leaf, color=treatment, shape=treatment)) +
  geom_line() +
  geom_point() +
  theme_classic() +
  theme(legend.position = "top") +
  labs(x="", y=buglab, shape="Treatment", color="Treatment") +
  geom_vline(xintercept=as.Date("20220115", format="%Y%m%d"), alpha=0.25) +
  geom_vline(xintercept=as.Date("20221015", format="%Y%m%d"), alpha=0.25) +
  geom_vline(xintercept=as.Date("20230315", format="%Y%m%d"), alpha=0.25) +
  geom_vline(xintercept=as.Date("20231015", format="%Y%m%d"), alpha=0.25)

```






