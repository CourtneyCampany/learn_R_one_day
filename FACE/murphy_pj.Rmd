---
title: "Mystery Data 4"
author: "PJ Murphy"
date: "4/20/2018"
output: word_document
---

```{r setup, include=FALSE}
library(doBy)
library(sciplot)
library(lubridate)
library(scales)
```

The elevated CO2 condition produced higher averages of photosynthesis for the duration of the three year study period. This suggests that elevated CO2 levels can impact a systems ability to photosynthesize. It should be noted that the fluctuations observed should be attributed to other factors, possibly sunlight or rainfall varaibility, and not CO2 treatment because the pattern of the data is similar between the two treatment types.

```{r photosynthesis, echo=FALSE}
photo <- read.csv("face_photosynthesis.csv")
photo$Date <- paste(photo$Date, "01", sep="_")
photo$CDate2 <- as.Date(photo$Date, format= "%b_%Y_%d")
photo_co2 <- summaryBy(Anet ~ CDate2 + treatment, data=photo, FUN=c(mean, se))
plot(Anet.mean ~ CDate2, data= photo_co2, type='n', xlab="Date", 
     ylab="Mean Annual Photosynthesis", ylim=c(14,34))
points(Anet.mean ~ CDate2, data=photo_co2[photo_co2$treatment=="eCO2",], type='b',
       bg="orange", pch=22)
points(Anet.mean ~ CDate2, data=photo_co2[photo_co2$treatment=="aCO2",], type='b',
       bg="green", pch=22)
treament_names <- c("elevated CO2", "ambient CO2")
legend("topright",legend=treament_names, pch=22,pt.bg=c("orange", "green"))
with(photo_co2, arrows(CDate2, Anet.mean, CDate2, Anet.mean-Anet.se, angle=90, 
                       length=0.03))
with(photo_co2, arrows(CDate2, Anet.mean, CDate2, Anet.mean+Anet.se, angle=90, 
                       length=0.03))

```
*Figure 1* Mean annual photosynthesis for elevated and ambient CO2 conditions over a three year period at a FACE sight. 

The response ratio is another way of visualizing the increase in photosynthesis caused by elevtated CO2 levels. The response ratio fluctuates greatly throughout the years and only reaches a high of just above 1.30. Therefore, the increase in photosynthesis caused by eCO2 is not as predicatable or significant as conveyed in the first graph. 

```{r response ratio, echo=FALSE}
eco3<- droplevels(photo_co2[photo_co2$treatment %in% "eCO2",])
colnames(eco3)[3]<-"eanet"
aco3<- droplevels(photo_co2[photo_co2$treatment %in% "aCO2",])
colnames(aco3)[3]<-"aanet"
resp_rat<-merge(eco3,aco3,by="CDate2")
resp_rat$rr<-resp_rat$eanet/resp_rat$aanet
plot(rr~CDate2,data=resp_rat,col="blue",type='l', xlab="Date", ylab="Response Ratio")
```
*Figure 2* shows the response ratio (eCO2/aCO2) of the treatment types over the three years at the FACE sight. 

Annual litter production did not vary greatly during the three years after CO2 treatment. While photosynthesis was seen to be greater in all years for the eCO2 treated group, litterfall was actually greater in the ambient CO2 condition, but only slightly. This is most likely because the plants that are receiving the elevated CO2 levels are not increasing their number of leaves. Because they are receiving more than enough CO2, they do not have to keep their stomata open for long and can allocate their extra energy to strucutral, maintanence or reproductive traits. 

```{r litter, echo=FALSE}
litter <- read.csv("face_litter.csv")
litter$treatment <- as.factor(ifelse(litter$ring == 2 |
                                       litter$ring == 3 |
                                       litter$ring == 6,
                                     "aCO2", "eCO2"))
line.num <- which.max(litter$twig)
litter <- litter[-line.num,]
basket <- .2 #basket size in m2
c_frac <- .47 #conversion to biomass carbon
line.num <- which.max(litter$twig)
litter <- litter[-line.num,]
litter$Date <- paste(litter$Date, "01", sep="_")
litter$CDate <- as.Date(litter$Date, format= "%d/%m/%Y")
litter$year <- as.factor(year(litter$CDate))
litter_carbon <- data.frame(litter[,c(1:3, 8:10)],
                             (litter[,4:7] * c_frac)/basket)
litter_mean_trap <- summaryBy(twig + bark+ seed + leaf ~ year + Date + ring +treatment,
                              data=litter_carbon, FUN=mean, na.rm=TRUE, keep.names = TRUE)
lit_annual <- summaryBy(twig + bark + seed + leaf ~ year + ring + treatment, data=litter_mean_trap, FUN=sum, na.rm=TRUE, keep.names = TRUE)
litter_co2 <- summaryBy(twig + bark+ seed + leaf ~ year + treatment, 
                        data=lit_annual, na.rm=TRUE, keep.names = TRUE)
litter_fum <- droplevels(litter_co2[litter_co2$year !=2020,])
litter_fum$totalflux <- with(litter_fum, twig+bark+seed+leaf)
bar_colors <- c("red", "blue", "red", "blue", "red", "blue")
b <- barplot(litter_fum$totalflux, col=bar_colors, ylab="Annual Litter Production (g)", ylim=c(0,300))
bar_colors <- c("red", "blue", "red", "blue", "red", "blue")
axis(1, at=b, labels=litter_fum[,2])
mtext(side=1, at=c(1.3,3.7,6.1), text=c("2021", "2022", "2023"), line=3)
box()

```
*Figure 3* Annual litter production (g) for both ambient and elevated CO2 treated FACE rings over a three year period. 

No general trend can be deduced from the data concerning ANPP and the CO2 treatments. In some years, ANPP from the aCO2 treament was greater than the elevated group while in some years this pattern was reversed. It should be noted that the error bars for the eCO2 treatments are much greater than those of the aCO2, suggesting that some indiviudals in the eCO2 treatment were growing much greater than the mean in terms of their biomass. There is a difference between the pattern observed here between the photosynthesis data and the ANPP because the elevated CO2 groups may be allocating their access energy to belowground biomass. The plants in the elevated CO2 are not limited by this gas, so they are expanding their root network in order to keep up with proper water balance. 
```{r ANPP, echo=FALSE}
wood1 <- read.csv("wood_npp.csv")
annual_litter <- read.csv("litter_annual.csv")

littera2 <- droplevels(annual_litter[annual_litter$year !=2020,])
colnames(wood1)[2] <- "ring"

anpp <- merge(wood1, littera2, by=c("year", "ring","treatment"))
anpp$anpp <- anpp$wood_yr + anpp$twig + anpp$bark + anpp$seed + anpp$leaf

anpplab <- expression(ANPP~~(gCm^-2~yr^-1))

boxplot(anpp ~ year*treatment, data=anpp, ylab=anpplab, axes=FALSE, 
        col=c("forestgreen", "coral"))
axis(1, at=c(1.5,3.5,5.5), labels=c("2021", "2022", "2023"))
axis(2)
box()
treatment_names <- c("aCO2", "eCO2")
legend("topright", legend=treatment_names, pch=21, col=c("forestgreen", "coral"), inset=0.02)
```
*Figure 4* Annual net primary production (gCm^-2 yr^-1) for elevated and ambient CO2 treatments for FACE sights. 

Over the three year experiment, a number of defoiliation events cause by insects were observed and are signified by the spikes in litter biomass. There seems to be an effect of elevated CO2 as the litter biomass for these groups are higher than ambient CO2 groups in the two major defoiliation events. A CO2 effect would not be expected to be observed as, the overall litter production for the eCO2 group was observed to be less than that of the aCO2 group. It is interesting that eCO2 has this effect because it is intuitive to think the opposite.
```{r wood, echo=FALSE}
litter <- read.csv("face_litter.csv")

basket <- .2
c_frac <- .47 

litter$CDate <- as.Date(litter$Date, format= "%d/%m/%Y")
litter$year <- as.factor(year(litter$CDate))
litter$treatment <- as.factor(ifelse(litter$ring == 2 |
                                       litter$ring == 3 |
                                       litter$ring == 6,
                                     "aCO2", "eCO2"))

line.num <- which.max(litter$twig)
litter <- litter[-line.num,]
line.num <- which.max(litter$twig)
litter <- litter[-line.num,]
litter_bugs <- summaryBy(leaf ~ CDate + treatment, data=litter, FUN=sum, na.rm=TRUE, 
                         keep.names = TRUE)
polydate <- c(as.Date("2021-12-12"), as.Date("2022-03-13"), as.Date("2022-09-15"), 
              as.Date("2022-11-12"), as.Date("2023-02-11"), as.Date("2023-04-17"), 
              as.Date("2023-09-11"), as.Date("2023-11-23"))
polycol <- alpha("grey", 0.5)

plot(leaf~CDate, data=litter_bugs, type='n', xlab="", ylab="Leaf Litter Biomass (g)")
points(leaf~CDate, data=litter_bugs[litter_bugs$treatment=="eCO2",], type='l', 
       col="forestgreen")
points(leaf~CDate, data=litter_bugs[litter_bugs$treatment=="aCO2",], type='l', 
       col="coral")
legend("topleft", legend=treatment_names, lty=1, col=c("forestgreen", "coral"), inset=0.02)
```
*Figure 5* Leaf litter biomass for both treatments, elevated and ambient C02, over a four year period, in respect to a number of defoiliation events caused by herbivory. 

